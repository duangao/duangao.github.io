<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>递归下降求解中缀、后缀、前缀表达式 - 羽加迪姆勒维奥萨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="最后一次更新，前面C++ 实现的版本已经很好的解释了递归下降的做法和威力，这里给一个scheme 的代码（前缀表达式的解析），利用递归的方法直接解决，代码中用到了racket 的正则表达式，可以去官网上查看非常丰富的相关文档内容。">
<meta property="og:type" content="article">
<meta property="og:title" content="递归下降求解中缀、后缀、前缀表达式">
<meta property="og:url" content="https://duangao.github.io/2014/09/15/递归下降求解中缀、后缀、前缀表达式/index.html">
<meta property="og:site_name" content="羽加迪姆勒维奥萨">
<meta property="og:description" content="最后一次更新，前面C++ 实现的版本已经很好的解释了递归下降的做法和威力，这里给一个scheme 的代码（前缀表达式的解析），利用递归的方法直接解决，代码中用到了racket 的正则表达式，可以去官网上查看非常丰富的相关文档内容。">
<meta property="og:image" content="http://images.cnitblog.com/blog2015/738055/201504/130037529303539.jpg">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="递归下降求解中缀、后缀、前缀表达式">
<meta name="twitter:description" content="最后一次更新，前面C++ 实现的版本已经很好的解释了递归下降的做法和威力，这里给一个scheme 的代码（前缀表达式的解析），利用递归的方法直接解决，代码中用到了racket 的正则表达式，可以去官网上查看非常丰富的相关文档内容。">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
          <a class="main-nav-link" href="https://duangaolife.github.io">Life(生活博客)</a>
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q" value="site:https://duangao.github.io"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <section id="main" class="outer"><article id="post-递归下降求解中缀、后缀、前缀表达式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      递归下降求解中缀、后缀、前缀表达式
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2014/09/15/递归下降求解中缀、后缀、前缀表达式/" class="article-date">
  <time datetime="2014-09-15T03:42:37.000Z" itemprop="datePublished">9月 15 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://images.cnitblog.com/blog2015/738055/201504/130037529303539.jpg" alt=""><br>最后一次更新，前面C++ 实现的版本已经很好的解释了递归下降的做法和威力，这里给一个scheme 的代码（前缀表达式的解析），利用递归的方法直接解决，代码中用到了racket 的正则表达式，可以去官网上查看非常丰富的相关文档内容。</p>
<a id="more"></a>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#lang racket&#10;&#10;(display &#34;this is a simple calulater,please input S-expression:\neg. operator num1 num2\noprator can use :&#10;+ - * / ** %&#34;)&#10;(define (power base n)&#10;  (if (= n 0)1&#10;      (* base (power base (- n 1)))))&#10;&#10;(define calulate &#10;&#10;  (lambda (exp)&#10;           (match exp&#10;             [(? number? x) x]&#10;             [`(, op , e1 , e2)&#10;              (&#10;               let(&#10;                   (v1 (calulate e1))&#10;                   (v2 (calulate e2))&#10;                   )&#10;                (match op&#10;                (&#39;+ (+ v1 v2))&#10;                (&#39;- (- v1 v2))&#10;                (&#39;* (* v1 v2))&#10;                (&#39;/ (/ v1 v2))&#10;                (&#39;** (power v1 v2))&#10;                (&#39;% (remainder v1 v2))  &#10;             ))]&#10;             ) ))</span><br></pre></td></tr></table></figure>
<hr>
<p>再进行一次更有意思的扩充，上次解决了+ - * / 和括号等，那么再加一些操作符怎么办呢？比如再加&gt;= &gt; &lt; &lt;= == != &amp;&amp; || ! ~ &amp;等等（这些操作符不是传统的算术运算，但是他们确实返回值是数，可以极好的当作之前文法定义的一个练习）</p>
<ul>
<li>首先，优先级大概像下面这个：从上到下优先级越来越高</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">digit</span><br><span class="line">&amp;&amp; || </span><br><span class="line"><span class="xml"><span class="tag">&lt; &lt;= =<span class="value">=</span> != &gt;</span></span> &gt;=</span><br><span class="line"><span class="bullet">+ </span>- </span><br><span class="line"><span class="bullet">* </span>/ %</span><br><span class="line"><span class="bullet">* </span>&amp; | ~ </span><br><span class="line"> ( )</span><br></pre></td></tr></table></figure>
<p>因此，扩充的语法定义：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="setting">digti=<span class="value">[<span class="number">0</span>-<span class="number">9</span>]+ </span></span></span><br><span class="line"><span class="setting">fact1=<span class="value">digit | <span class="string">"("</span> exp3 <span class="string">")"</span> </span></span></span><br><span class="line"><span class="setting">fact2=<span class="value">(！|~)fact1    </span></span></span><br><span class="line"><span class="setting">term = <span class="value">fact2 ( ( <span class="string">"*"</span> | <span class="string">"/"</span> ) fact2) *  </span></span></span><br><span class="line"><span class="setting">exp = <span class="value">term ( ( <span class="string">"+"</span> | <span class="string">"-"</span> ) term) * </span></span></span><br><span class="line"><span class="setting">exp2=<span class="value">exp ((&lt;=|&gt;=|&lt;|&gt;|==|!=) exp)* </span></span></span><br><span class="line"><span class="setting">exp3=<span class="value">exp2 ((&amp;&amp;| || ) exp2)*</span></span></span><br></pre></td></tr></table></figure>
<p>最后得到的结果就是exp3的result成员。</p>
<p>关于上面扩充的文法的实现如果理解了以前的内容，就非常简单了。</p>
<hr>
<p>修改：getNumber中添加一个简单的bool判断就可以扩充到负数的数值域中。</p>
<hr>
<ul>
<li>学习数据结构的时候学到栈的时候都会学习使用栈来实现求解中缀表达式，思路就是扫描一遍，数字输出，符号根据优先级决定入栈和出栈的时间，然后生成后缀表达式，对后缀表达式的求解是容易的，直接扫描一遍，遇到数字入栈，遇到操作符就直接取栈顶的两个元素做运算。</li>
<li><p>好久之前实现上面所说的程序是第一个感受“编译”的感觉，感觉很爽，因此一直想学一下真正的编译原理，龙书比较深奥，一直未得其奥义。这两天阅读了vczh大大的系列文章 《手写语法分析器》、《正则表达式引擎》等文章，颇有感触，遂有此文。</p>
</li>
<li><p>表达式比定义语言要容易的多，因为它可以把词法分析和语法分析很容易的结合起来，因为表达式中除了数字其它的符号均是单字符，直接判断就可以知道token类型，比较简单。</p>
</li>
<li>递归下降的核心在于写出无左递归的语法，写出来之后就直接写个程序去解释这个正则表达式就可以容易的搞定。</li>
</ul>
<h3 id="下面简单介绍一下前缀或者后缀表达式的递归下降分析：">下面简单介绍一下前缀或者后缀表达式的递归下降分析：</h3><ul>
<li><p>对于前缀，scheme中的表达式都采取这样的形式，这样的形式就无需词法分析了，没有优先级的歧义。</p>
</li>
<li><p>语法定义如下：</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">expr</span>=<span class="string">"("</span> op number number <span class="string">")"</span> | <span class="string">"（"</span> <span class="keyword">expr</span> <span class="string">"）"</span> |number</span><br><span class="line">        number= [<span class="number">0</span>-<span class="number">9</span>]*</span><br><span class="line">        op=<span class="string">'+'</span> | <span class="string">'-'</span> | <span class="string">'* | '</span>/<span class="string">'</span><br><span class="line">我们之间对每个部分进行翻译即可；</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>比如对于number<br>getnumber函数应该这么写：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">expr <span class="title">GetNumber</span><span class="params">(<span class="keyword">char</span>* &amp;stream)</span> </span><br><span class="line"></span><br><span class="line"></span>&#123; </span><br><span class="line"></span><br><span class="line">   expr number; <span class="comment">//存储结果，为一个expr类对象 </span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">char</span>* lookup = stream; </span><br><span class="line"> </span><br><span class="line">   <span class="keyword">while</span> ((*lookup) == <span class="string">' '</span>) lookup++; </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">bool</span> flag = <span class="keyword">false</span>; </span><br><span class="line">　　<span class="keyword">bool</span> symbol=<span class="keyword">false</span>；</span><br><span class="line">　　<span class="keyword">if</span>（*lookup == <span class="string">'-'</span>)</span><br><span class="line">　　　　symbol=<span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="keyword">true</span>) </span><br><span class="line"></span><br><span class="line"> &#123; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((*lookup )&lt;= <span class="string">'9'</span> &amp;&amp; (*lookup) &gt;= <span class="string">'0'</span>) </span><br><span class="line"></span><br><span class="line">   &#123; </span><br><span class="line"></span><br><span class="line">       number.result = number.result * <span class="number">10</span> + (*lookup) - <span class="string">'0'</span>; </span><br><span class="line"></span><br><span class="line">       ++lookup; </span><br><span class="line"></span><br><span class="line">       flag = <span class="keyword">true</span>; </span><br><span class="line"></span><br><span class="line">   &#125; </span><br><span class="line"></span><br><span class="line">   <span class="keyword">else</span> </span><br><span class="line"></span><br><span class="line">      <span class="keyword">break</span>; </span><br><span class="line"></span><br><span class="line"> &#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (flag) <span class="comment">//获得当前开头的数字，并将当前指针所指调整到数字后面一位 </span></span><br><span class="line"></span><br><span class="line">  stream = lookup; </span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> <span class="comment">//当前开头开始的不是数字，当前指针不变 </span></span><br><span class="line"></span><br><span class="line">&#123; </span><br><span class="line"></span><br><span class="line">  number.error = <span class="string">"there need a number!\n"</span>; </span><br><span class="line"> </span><br><span class="line">  number.error_position = lookup; </span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">if</span>(symbol)</span><br><span class="line">　　number.result=-number.result;</span><br><span class="line"><span class="keyword">return</span> number; </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有了getnumber之后getexpression就很容易了，核心部分如下：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">expr</span> expression;</span><br><span class="line">    <span class="type">char</span> *lookup = stream;</span><br><span class="line">    expression = <span class="type">GetNumber</span>(lookup);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (expression.error)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="type">Is</span>(lookup, <span class="string">"("</span>))</span><br><span class="line">        &#123;    </span><br><span class="line">            expression.error = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">char</span> op = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (op=<span class="type">IsOperator</span>(lookup))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">expr</span> left_expr = <span class="type">Getexpression</span>(lookup);</span><br><span class="line">                <span class="keyword">if</span> (left_expr.error)</span><br><span class="line">                    <span class="keyword">return</span> left_expr;</span><br><span class="line"></span><br><span class="line">                <span class="type">char</span> *copy_lookup = lookup;</span><br><span class="line">                </span><br><span class="line">                <span class="type">expr</span> right_expr = <span class="type">Getexpression</span>(lookup);</span><br><span class="line">                <span class="keyword">if</span> (right_expr.error )</span><br><span class="line">                    <span class="keyword">return</span> right_expr;</span><br><span class="line"></span><br><span class="line">                switch (op)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">case</span> '+':</span><br><span class="line">                        expression.<span class="literal">result</span> = left_expr.<span class="literal">result</span> + right_expr.<span class="literal">result</span>; <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> '-':</span><br><span class="line">                        expression.<span class="literal">result</span> = left_expr.<span class="literal">result</span> - right_expr.<span class="literal">result</span>; <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> '*':</span><br><span class="line">                        expression.<span class="literal">result</span> = left_expr.<span class="literal">result</span> * right_expr.<span class="literal">result</span>; <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> '/':</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span> (right_expr.<span class="literal">result</span> == <span class="number">0</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                            expression.error = <span class="string">"the number divided can not be zero!\n"</span>;</span><br><span class="line">                            expression.error_position = copy_lookup; <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            expression.<span class="literal">result</span> = left_expr.<span class="literal">result</span> / right_expr.<span class="literal">result</span>; <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    default:</span><br><span class="line">                    &#123;</span><br><span class="line">                        expression.error = <span class="string">"the wrong operator!\n"</span>;</span><br><span class="line">                        expression.error_position = lookup;</span><br><span class="line">                        <span class="keyword">return</span> expression;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                expression= <span class="type">Getexpression</span>(lookup);</span><br><span class="line">                <span class="keyword">if</span> (expression.error != <span class="number">0</span>) <span class="keyword">return</span> expression;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!<span class="type">Is</span>(lookup, <span class="string">")"</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                expression.error = <span class="string">"there need right bracket!\n"</span>;</span><br><span class="line">                expression.error_position = lookup;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(expression.error==<span class="number">0</span>)                     //成功获得了数字，因此将stream指针置于数字后面</span><br><span class="line">    &#123;</span><br><span class="line">        stream = lookup;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> expression;</span><br></pre></td></tr></table></figure>
<ul>
<li>中缀的代码就得自己写啦，我也是参考vczh大大的前缀代码写了一份前缀之后，自己写了一份中缀，我们很容易从中得到启示，找到递归下降的核心所在，据此可以写出中缀表达式的求解（中缀的求解代码完全是我自己写的，错误处理部分可能存在一些漏洞），相信根据上文自己写一个中缀一定有很多收获。</li>
</ul>

      
    </div>
  
    <footer class="article-footer">
      
    </footer>
  
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/10/25/BufferLab/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          BufferLab
        
      </div>
    </a>
  
  
    <a href="/2014/08/21/android手机屏幕解锁的种类数/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">android手机屏幕解锁的种类数&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
   	 Email: gaoduan0306@gmail.com  gaoduan0306@163.com 		</br>
   	 Anothor blog: <a href="http://www.cnblogs.com/gaoduan/">cnblog</a>.
    </div>
  </div>
</footer>
    

<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>